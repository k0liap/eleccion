var quform=function(e,l,n,i){"use strict";var o=e.core,a=o.cache,t=l(document),s=!1;function r(e){var t=l(this).closest(".qfb-entry-label-edit"),n=t.data("label"),i=e&&e.isValid()?e.toString():"";t.css("background-color",i),n.color=i}function c(e){return d.saveEntryLabelName.call(this,e),o.htmlEntities(e)}var b={showInput:!0,allowEmpty:!1,showAlpha:!0,preferredFormat:"hex",move:r,change:r,beforeShow:function(){l(this).spectrum("set",l(this).closest(".qfb-entry-label-edit").data("label").color)}},f={event:"click.editable",onblur:"submit",onreset:function(e,t){t.revert=o.htmlEntities(t.revert)},placeholder:"",select:!0},d={init:function(){l("#the-list").find(".delete a").click(function(){return confirm(i.singleDeleteEntryMessage)}),l("#doaction").click(function(){return 0<l('input[name="eids[]"]:checked').length&&("delete"==l("#bulk-action-selector-top").val()?confirm(i.pluralDeleteEntryMessage):void 0)}),l("#doaction2").click(function(){return 0<l('input[name="eids[]"]:checked').length&&("delete"==l("#bulk-action-selector-bottom").val()?confirm(i.pluralDeleteEntryMessage):void 0)}),a.get("#qfb-show-entries-table-settings").click(function(){d.showTableSettings()}),a.get("#qfb-entries-table-settings").find(".qfb-popup-save-button").click(function(){d.saveTableSettings()}),a.get("#qfb-entries-table-settings").find(".qfb-popup-close-button").click(function(){d.hideTableSettings()}),a.get("#qfb-entries-table-settings").find(".qfb-popup-overlay").click(function(){d.hideTableSettings()}),a.get("#qfb_forms_per_page").on("keyup",function(e){e.keyCode&&13==e.keyCode&&d.saveTableSettings()}),a.get("#qfb-active-columns").length&&a.get("#qfb-inactive-columns").length&&(200<a.get("#qfb-active-columns")[0].childElementCount+a.get("#qfb-inactive-columns")[0].childElementCount?(a.get("#qfb-setup-entries-table-layout").on("click",function(){a.get("#qfb-setup-entries-table-layout-loading").show(),setTimeout(function(){d.setupColumnLayoutSortables(function(){a.get("#qfb-setup-entries-table-layout-loading").hide(),a.get("#qfb-setup-entries-table-layout").hide(),a.get(".qfb-entries-table-layout").show()})},50)}),a.get(".qfb-entries-table-layout").hide(),a.get("#qfb-setup-entries-table-layout").show()):d.setupColumnLayoutSortables()),l.fn.qtip&&l(".qfb-tooltip-icon").qtip({show:{solo:!0},style:{classes:"qtip-dark qtip-dark-quform"},content:{text:function(){return l(this).find(".qfb-tooltip-content").html()}},hide:{fixed:!0},position:{viewport:!0,container:a.get("#qfb-entries-table-settings-inner")}}),a.get("#qfb-entry-label-search-trigger").click(function(){a.get("#qfb-entry-label-search").is(":visible")?a.get("#qfb-entry-label-search").hide():a.get("#qfb-entry-label-search").show()}),t.on("click",function(e){e&&e.which&&3===e.which||a.get("#qfb-entry-label-search").is(":visible")&&a.get("#qfb-entry-label-search").hide()}),a.get("#qfb-entry-label-search").add(a.get("#qfb-entry-label-search-trigger")).click(function(e){e.stopPropagation()}),a.get("#qfb-entry-label-search").on("click",".qfb-entry-label",function(){l(this).toggleClass("qfb-label-selected"),d.setSelectedSearchLabels()})},onWindowLoad:function(){a.get("#qfb-entry-labels-add").click(function(){var e={color:tinycolor.random().toString("hex"),name:""};a.get("#qfb-entry-labels-edit-empty").qfbSlideHide(function(){d.getEntryLabelEditHtml(e).hide().appendTo(a.get("#qfb-entry-labels-edit")).qfbSlideShow()})}),a.get("#qfb-entry-labels-edit").find(".qfb-entry-label-edit-name").editable(c,f),a.get("#qfb-entry-labels-edit").find(".qfb-entry-label-edit-action-color").spectrum(b),a.get("#qfb-entry-labels-edit").on("click",".qfb-entry-label-edit-action-duplicate",function(){var e=l(this).closest(".qfb-entry-label-edit"),t=e.data("label");e.after(d.getEntryLabelEditHtml({name:t.name,color:t.color}))}),a.get("#qfb-entry-labels-edit").on("click",".qfb-entry-label-edit-action-remove",function(){l(this).closest(".qfb-entry-label-edit").qfbSlideHide(function(){l(this).remove(),a.get("#qfb-entry-labels-edit").find(".qfb-entry-label-edit").length||a.get("#qfb-entry-labels-edit-empty").qfbSlideShow()})}),t.on("heartbeat-tick",function(e,t){t&&t.nonces_expired&&t.quformSaveEntriesTableSettingsNonce&&i.saveEntriesTableSettingsNonce!==t.quformSaveEntriesTableSettingsNonce&&(i.saveEntriesTableSettingsNonce=t.quformSaveEntriesTableSettingsNonce)})},showTableSettings:function(){a.get("body").css("overflow","hidden").addClass("qfb-popup-open"),a.get("#qfb-entries-table-settings").show()},hideTableSettings:function(){a.get("body").css("overflow","").removeClass("qfb-popup-open"),a.get("#qfb-entries-table-settings").hide(),a.get("#qfb-entries-table-settings").find(".qfb-submission-error").remove(),a.get("#qfb-entries-table-settings").find(".qfb-validation-error").remove()},saveTableSettings:function(){var e,t;s||(s=!0,a.get("#qfb-entries-table-settings").find(".qfb-submission-error").remove(),a.get("#qfb-entries-table-settings").find(".qfb-validation-error").remove(),e=[],a.get("#qfb-active-columns").find("> div").each(function(){e.push(l(this).data("column"))}),t=[],a.get("#qfb-entry-labels-edit").find("> .qfb-entry-label-edit").each(function(){t.push(l(this).data("label"))}),l.ajax({url:n.ajaxUrl,type:"POST",dataType:"json",data:{action:"quform_save_entries_table_settings",_ajax_nonce:i.saveEntriesTableSettingsNonce,per_page:a.get("#qfb_entries_per_page").val(),columns:e,labels:t,id:a.get("#qfb_form_id").val()}}).done(function(e){var i;e=o.sanitizeResponse(e),s=!1,"success"==e.type?window.location.reload():"error"!=e.type&&"invalid"!=e.type||(i=[],e.message&&i.push(o.addSubmissionError(a.get("#qfb-entries-table-settings").find(".qfb-settings"),e.message)),e.errors&&l.each(e.errors,function(e,t){var n=a.get("#"+e).closest(o.settingInputWrap);o.addValidationError(n,t),i.push(n)}),i.length&&o.scrollTo(i[0],a.get("#qfb-entries-table-settings-inner")))}).fail(function(){o.scrollTo(o.addSubmissionError(a.get("#qfb-entries-table-settings").find(".qfb-settings"),n.ajaxError),a.get("#qfb-entries-table-settings-inner")),s=!1}))},setSelectedSearchLabels:function(){var t=[];a.get("#qfb-entry-label-search").find(".qfb-label-selected").each(function(){t.push(""+l(this).data("id"))}),a.get("#qfb-entry-label-search-ids").find("> option").each(function(){var e=l(this);-1<l.inArray(e.val(),t)?e.prop("selected",!0):e.prop("selected",!1)})},getEntryLabelEditHtml:function(e){var t=l(i.entryLabelEditHtml);return t.find(".qfb-entry-label-edit-name").text(e.name).editable(c,f),t.css("background-color",e.color),t.data("label",e),t.find(".qfb-entry-label-edit-action-color").spectrum(b),t},saveEntryLabelName:function(e){l(this).closest(".qfb-entry-label-edit").data("label").name=e},setupColumnLayoutSortables:function(e){a.get("#qfb-active-columns").sortable({connectWith:"#qfb-inactive-columns",placeholder:"qfb-sortable-entries-columns-placeholder",tolerance:"pointer"}),a.get("#qfb-inactive-columns").sortable({connectWith:"#qfb-active-columns",placeholder:"qfb-sortable-entries-columns-placeholder",tolerance:"pointer",create:function(){"function"==typeof e&&e()}})}};return l(d.init),l(window).on("load",d.onWindowLoad),e.entries=e.entries||{},e.entries.list=d,e}(quform,jQuery,quformCoreL10n,quformEntriesListL10n);